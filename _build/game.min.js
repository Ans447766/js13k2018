var e;e=function(){var e=function(){function t(e){return o.appendChild(e.dom),e}function n(e){for(var t=0;t<o.children.length;t++)o.children[t].style.display=t===e?"block":"none";r=e}var r=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(e){e.preventDefault(),n(++r%o.children.length)},!1);var a=(performance||Date).now(),i=a,l=0,s=t(new e.Panel("FPS","#0ff","#002")),c=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:o,addPanel:t,showPanel:n,begin:function(){a=(performance||Date).now()},end:function(){l++;var e=(performance||Date).now();if(c.update(e-a,200),e>i+1e3&&(s.update(1e3*l/(e-i),100),i=e,l=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:o,setMode:n}};return e.Panel=function(e,t,n){var r=1/0,o=0,a=Math.round,i=a(window.devicePixelRatio||1),l=80*i,s=48*i,c=3*i,u=2*i,d=3*i,f=15*i,y=74*i,p=30*i,h=document.createElement("canvas");h.width=l,h.height=s,h.style.cssText="width:80px;height:48px";var w=h.getContext("2d");return w.font="bold "+9*i+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=n,w.fillRect(0,0,l,s),w.fillStyle=t,w.fillText(e,c,u),w.fillRect(d,f,y,p),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(d,f,y,p),{dom:h,update:function(s,v){r=Math.min(r,s),o=Math.max(o,s),w.fillStyle=n,w.globalAlpha=1,w.fillRect(0,0,l,f),w.fillStyle=t,w.fillText(a(s)+" "+e+" ("+a(r)+"-"+a(o)+")",c,u),w.drawImage(h,d+i,f,y-i,p,d,f,y-i,p),w.fillRect(d+y-i,f,i,p),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(d+y-i,f,i,a((1-s/v)*p))}}},e},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):this.Stats=e(),function(){var e=window;const n=256,r=256,o=n*r,a=o,i=9*o,l=Math;Object.getOwnPropertyNames(l).forEach(t=>e[t]=e[t]||l[t]),viewX=0,viewY=0,viewW=n,viewH=r,cursorX=0,cursorY=0,cursorColor=22,cursorColor2=0,floodStack=[],fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0],pat=65535,palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];var s=document.getElementById("canvas"),c=(document.createElement("canvas").getContext("2d"),s.getContext("2d")),u=0,d=[4278715910,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610];pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],c.imageSmoothingEnabled=!1,s.width=n,s.height=r;var f=c.getImageData(0,0,n,r),y=new ArrayBuffer(f.data.length),p=new Uint8Array(y),h=new Uint32Array(y),w=new Uint8Array(n*r*20);function v(e=0,t=u){w.fill(e,t,t+o)}function x(e=cursorColor,t=cursorColor2){cursorColor=e,cursorColor2=t}function g(e,t){let o=(t|=0)%4*4+(e|=0)%4,a=pat&Math.pow(2,o),i=a?cursorColor:cursorColor2;0!=i&&(i>63&&(i=0),0>e|e>n-1||0>t|t>r-1||(w[u+t*n+e]=a?cursorColor:cursorColor2))}function m(e,t,n,r,o=cursorColor,a=cursorColor2){cursorX=n,cursorY=r,cursorColor2=a,cursorColor=o;var i,l,s=(r|=0)-(t|=0),c=(n|=0)-(e|=0);if(0>s?(s=-s,l=-1):l=1,0>c?(c=-c,i=-1):i=1,s<<=1,c<<=1,g(e,t),c>s)for(var u=s-(c>>1);e!=n;)0>u||(t+=l,u-=c),u+=s,g(e+=i,t);else for(u=c-(s>>1);t!=r;)0>u||(e+=i,u-=s),u+=c,g(e,t+=l)}function C(e,t,n=16,r=16,o=cursorColor,a=cursorColor2){cursorColor2=a,cursorColor=o,x1=0|e,y1=0|t,n|=0,r|=0,m(x1,y1,n,y1,o),m(n,y1,n,r,o),m(x1,r,n,r,o),m(x1,y1,x1,r,o)}function S(e,t,n=16,r=16,o=cursorColor,a=cursorColor2){cursorColor2=a,cursorColor=o,x1=0|e,y1=0|t,n|=0,o|=0;var i=(r|=0)-y1;if(m(x1,y1,n,y1,o),i>0)for(;--i;)m(x1,y1+i,n,y1+i,o);else if(0>i)for(;++i;)m(x1,y1+i,n,y1+i,o);m(x1,r,n,r,o)}function b(e){e[7]||(e[7]=1),e[8]||(e[8]=1);for(var n=e[0].length,r=0;n>r;r++){var o;l=e[0].charAt(r),index=fontString.indexOf(l),o=fontBitmap.substring(25*index,25*index+25).split("");for(var a=0;5>a;a++)for(var i=0;5>i;i++)if(1==o[5*a+i])if(1==e[4])g(e[1]+i*e[4]+(5*e[4]+e[3])*r,e[2]+(e[6]?Math.sin(1*(t+r*e[8])/e[7])*e[6]:0)+a*e[4]|0);else{let n=e[1]+i*e[4]+(5*e[4]+e[3])*r,o=e[2]+(e[6]?Math.sin(1*(t+r*e[8])/e[7])*e[6]:0)+a*e[4]|0;S(n,o,n+e[4],o+e[4],e[5])}}var l}function D(e){var t=5*e[7],n=e[0].split("\n"),r=n.slice(0),o=n.length,a=r.sort(function(e,t){return t.length-e.length})[0],i=a.length*t+(a.length-1)*e[3],l=o*t+(o-1)*e[4];e[5]||(e[5]="left"),e[6]||(e[6]="bottom");var s=e[1],c=e[2],u=e[1]+i,d=e[2]+l;"center"==e[5]?(s=e[1]-i/2,u=e[1]+i/2):"right"==e[5]&&(s=e[1]-i,u=e[1]),"center"==e[6]?(c=e[2]-l/2,d=e[2]+l/2):"bottom"==e[6]&&(c=e[2]-l,d=e[2]);for(var f=s+i/2,y=c+l/2,p=0;o>p;p++){var h=n[p],w=h.length*t+(h.length-1)*e[3],v=e[1],x=e[2]+(t+e[4])*p;"center"==e[5]?v=e[1]-w/2:"right"==e[5]&&(v=e[1]-w),"center"==e[6]?x-=l/2:"bottom"==e[6]&&(x-=l),b([h,v,x,e[3]||0,e[7]||1,e[8],e[9],e[10],e[11]])}return{sx:s,sy:c,cx:f,cy:y,ex:u,ey:d,width:i,height:l}}function I(e=Date.now(),t=1664525,n=1013904223,r=Math.pow(2,32)){this.seed=e,this.a=t,this.c=n,this.m=r}audioCtx=new AudioContext,Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)},Number.prototype.map=function(e,t,n,r){return(this-e)/(t-e)*(r-n)+n},Number.prototype.pad=function(e,t="0"){for(var n=String(this);n.length<(e||2);)n=t+n;return n},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},I.prototype.setSeed=function(e){this.seed=e},I.prototype.nextInt=function(){return this.seed=(this.seed*this.a+this.c)%this.m,this.seed},I.prototype.nextFloat=function(){return this.nextInt()/this.m},I.prototype.nextBool=function(e){return null==e&&(e=.5),this.nextFloat()<e},I.prototype.nextFloatRange=function(e,t){return e+this.nextFloat()*(t-e)},I.prototype.nextIntRange=function(e,t){return Math.floor(this.nextFloatRange(e,t))},I.prototype.nextColor=function(){for(var e=this.nextIntRange(0,Math.pow(2,24)).toString(16).toUpperCase();6>e.length;)e="0"+e;return"#"+e};var K=function(){var e,t,n,r,o,a=function(e){return Math.sin(6.283184*e)},i=function(e){return.003959503758*Math.pow(2,(e-128)/12)},l=function(e,t,n){var r,o,a,l,c,u,d,f=s[e.i[0]],y=e.i[1],p=e.i[3],h=s[e.i[4]],w=e.i[5],v=e.i[8],x=e.i[9],g=e.i[10]*e.i[10]*4,m=e.i[11]*e.i[11]*4,C=e.i[12]*e.i[12]*4,S=1/C,b=e.i[13],D=n*Math.pow(2,2-e.i[14]),I=new Int32Array(g+m+C),K=0,M=0;for(r=0,o=0;g+m+C>r;r++,o++)0>o||(o-=D,u=i(t+(15&(b=b>>8|(255&b)<<4))+e.i[2]-128),d=i(t+(15&b)+e.i[6]-128)*(1+8e-4*e.i[7])),a=1,g>r?a=r/g:g+m>r||(a-=(r-g-m)*S),l=u,p&&(l*=a*a),c=f(K+=l)*y,l=d,v&&(l*=a*a),c+=h(M+=l)*w,x&&(c+=(2*Math.random()-1)*x),I[r]=80*c*a|0;return I},s=[a,function(e){return.5>e%1?1:-1},function(e){return e%1*2-1},function(e){var t=e%1*4;return 2>t?t-1:3-t}];this.init=function(a){e=a,t=a.endPattern,n=0,r=a.rowLen*a.patternLen*(t+1)*2,o=new Int32Array(r)},this.generate=function(){var i,c,u,d,f,y,p,h,w,v,x,g,m,C,S=new Int32Array(r),b=e.songData[n],D=e.rowLen,I=e.patternLen,K=0,M=0,E=!1,R=[];for(u=0;t>=u;++u)for(p=b.p[u],d=0;I>d;++d){var Y=p?b.c[p-1].f[d]:0;Y&&(b.i[Y-1]=b.c[p-1].f[d+I]||0,16>Y&&(R=[]));var A=s[b.i[15]],X=b.i[16]/512,P=Math.pow(2,b.i[17]-9)/D,L=b.i[18],O=b.i[19],z=43.23529*b.i[20]*3.141592/44100,j=1-b.i[21]/255,k=1e-5*b.i[22],F=b.i[23]/32,G=b.i[24]/512,T=6.283184*Math.pow(2,b.i[25]-9)/D,B=b.i[26]/255,H=b.i[27]*D&-2;for(x=(u*I+d)*D,f=0;4>f;++f)if(y=p?b.c[p-1].n[d+f*I]:0){R[y]||(R[y]=l(b,y,D));var N=R[y];for(c=0,i=2*x;c<N.length;c++,i+=2)S[i]+=N[c]}for(c=0;D>c;c++)(v=S[h=2*(x+c)])||E?(g=z,L&&(g*=A(P*h)*X+.5),M+=(g=1.5*Math.sin(g))*(m=j*(v-M)-(K+=g*M)),v=3==O?M:1==O?m:K,k&&(v=1>(v*=k)?v>-1?a(.25*v):-1:1,v/=k),E=(v*=F)*v>1e-5,C=v*(1-(w=Math.sin(T*h)*G+.5)),v*=w):C=0,H>h||(C+=S[h-H+1]*B,v+=S[h-H]*B),S[h]=0|C,S[h+1]=0|v,o[h]+=0|C,o[h+1]+=0|v}return++n/e.numChannels},this.createWave=function(){var e=44+2*r-8,t=e-36,n=new Uint8Array(44+2*r);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var a=0,i=44;r>a;++a){var l=o[a];l=-32767>l?-32767:l>32767?32767:l,n[i++]=255&l,n[i++]=l>>8&255}return n},this.getBuffer=function(){return o},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),r=new Array(t),a=0;2*t>a;a+=1){var i=n+a;r[a]=e>0&&i<o.length?o[i]/32768:0}return r}},M={songData:[{i:[3,138,116,0,0,138,128,4,0,0,47,48,166,124,3,0,139,4,1,3,64,160,3,32,147,4,121,5],p:[1,1,4,2,3],c:[{n:[111],f:[]},{n:[114],f:[]},{n:[113],f:[]},{n:[112,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,113],f:[]}]}],rowLen:5513,patternLen:32,endPattern:4,numChannels:1};player={x:100,y:100,index:{x:0,y:0},oldX:0,oldY:0,vx:2,vy:2,width:6,height:10,color:12,gravity:gravity=4,tx:0,ty:0,gid:0,draw:function(e){let t=this.x-viewX,n=this.y-viewY,r=this.y%28>14?0:1,o=(this.x,this.y%40>20?0:1);S(t+1,n+o,t+5,n+4+o,22,22),S(t,n+1+o,t+this.width,n+3+o),S(t+2,n+2,t+4,n+10),g(t,n+7),g(t+6,n+7),m(t+1,n+6,t+5,n+6),m(t+1,n+10,t+1,n+11+r),m(t+5,n+10,t+5,n+11+!r)},update:function(){player.oldX=player.x,player.oldY=player.y,Key.isDown(Key.d)||Key.isDown(Key.RIGHT)?player.x+=player.vx:(Key.isDown(Key.a)||Key.isDown(Key.LEFT)||Key.isDown(Key.q))&&(player.x-=player.vx),Key.isDown(Key.w)||Key.isDown(Key.UP)||Key.isDown(Key.z)?player.y-=player.vy:(Key.isDown(Key.s)||Key.isDown(Key.DOWN))&&(player.y+=player.vy),1!=getGID(player.x,player.y)&&1!=getGID(player.x+player.width-1,player.y)&&1!=getGID(player.x+player.width-1,player.y+player.height-1)&&1!=getGID(player.x,player.y+player.height-1)||(player.xVel=0,player.x=player.oldX,player.y=player.oldY),Key.justReleased(Key.x)&&2==getGID(player.x+player.width/2,player.y+player.height/2)&&(foundSwitch=switches.find(function(e){return e.index==getIndex(player.x,player.y)}),foundSwitch&&(foundSwitch.state=1))}},switches=[],objects=[],states={},init=(()=>{stats=new Stats,stats.showPanel(1),document.body.appendChild(stats.dom),lcg=new I(1019),drawMap(),createSwitches(),state="menu",last=0,t=0,audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),deadzoneX=50,deadzoneY=50,viewX=player.x-n/2,viewY=player.y-r/2,sounds={},music=new K,music.init(M),done=!1,setInterval(function(){done||(done=1==music.generate(),done&&(wave=music.createWave().buffer,audioCtx.decodeAudioData(wave,function(e){sounds.song=e,function(e,t=1,n=0,r=.5,o=!1){var a=audioCtx.createBufferSource(),i=audioCtx.createGain(),l=audioCtx.createStereoPanner();a.buffer=e,a.connect(l),l.connect(i),i.connect(audioMaster),a.playbackRate.value=t,a.loop=o,i.gain.value=r,l.pan.value=n,a.start()}(sounds.song,1,0,.5,!0)})))},0),paused=!1,loop()}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(e=>{stats.begin(),paused?(x(22,22),u=0,D(["PAUSED",n/2,128,3,1,"center","top",3,21,0]),audioMaster.gain.value=0):(dt=1,t+=1,audioMaster.gain.value=1,states[state].step(1),states[state].draw()),Key.update(),function(){let e=o;for(;e--;)h[e]=d[pal[w[e]]];f.data.set(p),c.putImageData(f,0,0)}(),stats.end(),requestAnimationFrame(loop)}),drawMap=(e=>{u=i,x(1,1),C(1,1,n,r,1);for(let e=0;1e3>e;e++){let e=lcg.nextIntRange(1,n),t=lcg.nextIntRange(1,r);S(e,t,e+2,t+2)}u=0}),createSwitches=(e=>{for(let e=0;1e3>e;e++){var t=lcg.nextIntRange(2,255),n=lcg.nextIntRange(2,255);u=i,x(2,2),g(t,n),u=0,switches.push({x:t,y:n,index:getIndex(16*t,16*n),color:lcg.nextIntRange(1,10),state:0})}}),drawSwitches=(e=>{switches.forEach(function(e){var t=16*e.y-viewY,o=16*e.x-viewX;if(function(e,t,o=64){return!(0-o>e||e>n+o||0-o>t||t>r+o)}(o,t,16))switch(u=0,e.state){case 2:break;case 1:t=16*e.y-viewY,S(2+(o=16*e.x-viewX),t+2,o+16-2,t+16-2,e.color,0);break;default:t=16*e.y-viewY,S(2+(o=16*e.x-viewX),t+2,o+16-2,t+16-2,0,2)}})}),getIndex=((e,t)=>i+(e/16|0)+256*(t/16|0)),getGID=((e,t)=>w[getIndex(e,t)]),drawObjects=(e=>{objects.forEach(function(e){e.draw()})}),updateObjects=(e=>{objects.forEach(function(e){e.update()})}),states.menu={step:function(e){Key.justReleased(Key.SPACE)&&(state="game")},draw:function(e){u=0,v(0),S(0,0,20,20,4),D(["OFFLINE\nGAME",n/2,100,3,9,"center","top",5,21,0]),D(["PRESS SPACE TO PLAY",n/2,190,3,9,"center","top",2,21,0])}},states.game={step:function(e){player.update(e),updateObjects(),player.x-viewX+deadzoneX>viewW?viewX=player.x-(viewW-deadzoneX):player.x-deadzoneX<viewX&&(viewX=player.x-deadzoneX),player.y-viewY+deadzoneY>viewH?viewY=player.y-(viewH-deadzoneY):player.y-deadzoneY<viewY&&(viewY=player.y-deadzoneY)},draw:function(e){pat=dither[8],u=a,v(0),S(0,0,n,r,2),u=0,v(0);let t=viewX/16-3|0,o=(viewX+n)/16+3|0,l=viewY/16-3|0,s=(viewY+r)/16+3|0;for(let e=t;o>e;e++)for(let t=l;s>t;t++){let n,r;switch(w[i+256*t+e]){case 1:S(1+(n=16*e-viewX),1+(r=16*t-viewY),n+16-1,r+16-1,8,7),C(n,r,n+16+1,r+16+1,6,7);break;case 2:break;default:S(n=16*e-viewX,r=16*t-viewY,n+16,r+16,2,1),C(n,r,n+16,r+16,2,3)}}drawObjects(),drawSwitches(),player.draw()}},window.init()}();